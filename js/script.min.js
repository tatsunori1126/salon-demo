document.addEventListener("DOMContentLoaded",function(){let a=document.getElementById("reservation-modal");if(a){let t=document.getElementById("modal-calendar"),n="",d="",o=0,s="",u="";function l(){var e=new FormData;e.append("action","salon_render_calendar_front"),e.append("menu",n),e.append("staff",d),e.append("week",o),e.append("mode","front"),t.innerHTML="èª­ã¿è¾¼ã¿ä¸­â€¦",fetch(salon_ajax.url,{method:"POST",body:e}).then(e=>e.text()).then(e=>{t.innerHTML=e;e=t.querySelectorAll(".slot-btn");console.log("slot-btn count:",e.length),e.forEach(r=>{r.addEventListener("click",()=>{s=r.dataset.date,u=r.dataset.time,d=r.dataset.staff;var e=document.querySelector("#your-name")||document.querySelector("#f-name"),t=document.querySelector("#your-email")||document.querySelector("#f-email"),n=document.querySelector("#your-tel")||document.querySelector("#f-tel"),o=document.querySelector("#m-menu")||document.querySelector("#res_menu")||document.querySelector("#menu_key"),o=o?.options?.[o.selectedIndex]?.textContent||"-",a=document.querySelector("#m-staff")||document.querySelector("#res_staff")||document.querySelector("#staff_id"),a=a?.options?.[a.selectedIndex]?.textContent||"è‡ªå‹•å‰²å½“",l=document.querySelector("#step-2"),c=document.querySelector("#step-3");document.getElementById("c-name").textContent=e?.value||"-",document.getElementById("c-email").textContent=t?.value||"-",document.getElementById("c-tel").textContent=n?.value||"-",document.getElementById("c-menu").textContent=o,document.getElementById("c-staff").textContent=a,document.getElementById("c-datetime").textContent=s+" "+u,l&&c?(l.style.display="none",c.style.display="block"):console.warn("step-2 ã¾ãŸã¯ step-3 ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")})})}).catch(()=>{t.innerHTML="èª­ã¿è¾¼ã¿å¤±æ•—"})}a.addEventListener("change",e=>{n=document.querySelector("#m-menu")?.value||document.querySelector("#res_menu")?.value||document.querySelector("#menu_key")?.value||"default",d=document.querySelector("#m-staff")?.value||document.querySelector("#res_staff")?.value||document.querySelector("#staff_id")?.value||"",e.target.matches("#m-staff, #res_staff, #staff_id")&&(n&&"default"!==n&&"0"!==n?(console.log("ğŸŒ€ æ‹…å½“å¤‰æ›´ â†’ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†èª­ã¿è¾¼ã¿",{menu:n,staff:d,week:o}),l()):console.log("âš  ãƒ¡ãƒ‹ãƒ¥ãƒ¼æœªé¸æŠã®ãŸã‚ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚’ã‚¹ã‚­ãƒƒãƒ—"))}),a.addEventListener("click",e=>{var t=e.target.closest(".btn-week");t?(e.preventDefault(),"prev"===(t=t.dataset.week)&&o--,"next"===t&&o++,"today"===t&&(o=0),n=document.querySelector("#m-menu")?.value||document.querySelector("#res_menu")?.value||document.querySelector("#menu_key")?.value||"cut",d=document.querySelector("#m-staff")?.value||document.querySelector("#res_staff")?.value||document.querySelector("#staff_id")?.value||0,console.log("ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:",{menu:n,staff:d,week:o}),l()):(t=e.target.closest(".slot-btn"))&&(e.preventDefault(),a.querySelectorAll(".slot-btn.selected").forEach(e=>e.classList.remove("selected")),t.classList.add("selected"),s=t.dataset.date,u=t.dataset.time,d=t.dataset.staff,e="1"===t.dataset.autoassign?"è‡ªå‹•å‰²å½“":document.querySelector("#m-staff")?.selectedOptions?.[0]?.textContent||"-",console.log(`é¸æŠ: ${s} ${u} / ã‚¹ã‚¿ãƒƒãƒ•: `+e),document.getElementById("c-menu").textContent=document.querySelector("#m-menu")?.selectedOptions?.[0]?.textContent||"-",document.getElementById("c-staff").textContent=e,document.getElementById("c-datetime").textContent=s+" "+u,step2&&step3?(step2.style.display="none",step3.style.display="block"):console.warn("âš  step2 ã¾ãŸã¯ step3 ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"))})}}),jQuery(function(o){let a=0;function t(){var e=o("#menu_key").val()||o("#res_menu").val()||"cut",t=o("#staff_id").val()||o("#res_staff").val()||3,n=(console.log("ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:",{menuKey:e,staffId:t,currentWeek:a}),new FormData);n.append("action","salon_render_calendar_public_readonly"),n.append("menu_key",e),n.append("staff_id",t),n.append("week",a),fetch(salon_ajax.url,{method:"POST",body:n}).then(e=>e.text()).then(e=>{o("#readonly-calendar").html(e)}).catch(()=>alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"))}o.ajaxSetup({cache:!1}),o("body").off("click.salonNextWeek").on("click.salonNextWeek","#next-week",function(e){e.preventDefault(),a++,t()}),o("body").off("click.salonPrevWeek").on("click.salonPrevWeek","#prev-week",function(e){e.preventDefault(),a--,t()}),t()}),document.addEventListener("DOMContentLoaded",function(){let l=document.querySelector(".salon-calendar-wrapper");if(l){let o=l.querySelectorAll(".salon-calendar-tabs .tab"),a=l.querySelector("#salon-calendar-content");o.forEach(e=>{e.addEventListener("click",function(){o.forEach(e=>e.classList.remove("active")),this.classList.add("active");var e=this.dataset.staff,t=l.dataset.menu,n=l.dataset.week;a.innerHTML='<p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>',fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"salon_load_calendar",staff_id:e,menu_key:t,week:n})}).then(e=>e.text()).then(e=>{a.innerHTML=e}).catch(e=>{a.innerHTML='<p class="error">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>'})})})}}),document.addEventListener("DOMContentLoaded",function(){let y=document.getElementById("confirm-btn");y?y.addEventListener("click",async e=>{if(e.preventDefault(),!y.disabled){console.log("âœ… äºˆç´„ç¢ºå®šãƒœã‚¿ãƒ³æŠ¼ä¸‹");var e=document.querySelector("#step-2"),n=document.querySelector("#step-3"),t=document.querySelector("#your-name")||document.querySelector("#f-name"),o=document.querySelector("#your-email")||document.querySelector("#f-email"),a=document.querySelector("#your-tel")||document.querySelector("#f-tel"),l=(document.querySelector("#m-menu")||document.querySelector("#res_menu")||document.querySelector("#menu_key"))?.value||"default",c=(document.querySelector("#m-staff")||document.querySelector("#res_staff")||document.querySelector("#staff_id"))?.value||0,[r,d]=(document.getElementById("c-datetime")?.textContent?.trim()||"").split(" ");if(salon_ajax&&salon_ajax.url&&salon_ajax.nonce){console.log("ğŸ“¦ é€ä¿¡ãƒ‡ãƒ¼ã‚¿",{selDate:r,selTime:d,selMenuKey:l,selStaffId:c});var s=new FormData;s.append("action","salon_submit_reservation"),s.append("nonce",salon_ajax.nonce),s.append("name",t?.value||""),s.append("email",o?.value||""),s.append("tel",a?.value||""),s.append("menu",l),s.append("staff",c),s.append("date",r),s.append("time",d),y.disabled=!0,y.textContent="é€ä¿¡ä¸­...";try{var u=await(await fetch(salon_ajax.url,{method:"POST",body:s})).json();if(console.log("ğŸ“¥ å¿œç­”:",u),y.disabled=!1,y.textContent="ã“ã®å†…å®¹ã§ç¢ºå®š",u.success){alert(u.data.msg||"ã”äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼"),y.disabled=!0,y.textContent="äºˆç´„æ¸ˆã¿";let t=document.querySelector(".salon-calendar");t&&fetch(location.origin+`/wp-admin/admin-ajax.php?action=salon_get_calendar_html&menu_key=${l}&staff_id=`+c).then(e=>e.text()).then(e=>{t.innerHTML=e,console.log("âœ… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°å®Œäº†")}).catch(e=>console.error("âŒ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†å–å¾—ã‚¨ãƒ©ãƒ¼:",e));try{var m,i=document.querySelector(".modal-close, .js-modal-close, .p-reservation__modal-close, [data-modal-close], .close-btn");i?(console.log("ğŸ•“ é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¾ã™"),i.click()):(m=document.querySelector(".modal, .p-reservation__modal, .reservation-modal"))?(m.classList.remove("is-active","open","show","active"),m.style.opacity="",m.style.pointerEvents="",m.style.visibility="",m.style.display="",console.log("âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¾ã—ãŸï¼ˆå†ã‚ªãƒ¼ãƒ—ãƒ³å¯èƒ½ï¼‰")):console.warn("âš ï¸ ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")}catch(e){console.error("âŒ ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰é–å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼:",e)}e&&n&&(e.style.display="none",n.style.display="block")}else alert(u.data?.msg||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚")}catch(e){console.error("é€šä¿¡ã‚¨ãƒ©ãƒ¼:",e),y.disabled=!1,y.textContent="ã“ã®å†…å®¹ã§ç¢ºå®š",alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}}else console.error("âŒ salon_ajax ãŒæœªå®šç¾©ã¾ãŸã¯ nonce ãŒå­˜åœ¨ã—ã¾ã›ã‚“"),alert("nonceãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚functions.php ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")}}):console.warn("âš ï¸ confirm-btn ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")});